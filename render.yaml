services:
  # Web Service
  - type: web
    name: safmc-fmp-tracker
    env: python
    region: oregon
    plan: starter
    buildCommand: |
      set -e
      echo "=== Installing Python dependencies ==="
      pip install -r requirements.txt

      echo "=== Building React app ==="
      cd client
      echo "Current directory: $(pwd)"
      echo "Files in client: $(ls -la)"

      echo "=== Installing npm dependencies ==="
      npm install

      echo "=== Running npm build ==="
      npm run build

      echo "=== Checking build output ==="
      if [ -d "dist" ]; then
        echo "✓ Build successful! Contents of dist:"
        ls -la dist/
      else
        echo "✗ Build failed! dist folder not created"
        exit 1
      fi

      cd ..
      chmod +x start.sh
      echo "=== Build complete ==="
    startCommand: "./start.sh"
    envVars:
      - key: FLASK_ENV
        value: production
      - key: ENABLE_SCHEDULER
        value: true
      - key: SECRET_KEY
        generateValue: true
      - key: DATABASE_URL
        fromDatabase:
          name: safmc-fmp-tracker-db
          property: connectionString
